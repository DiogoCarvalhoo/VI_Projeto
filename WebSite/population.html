<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <!-- MY CSS -->
    <link href="CSS/menu.css" rel="stylesheet" />
    <link href="CSS/home.css" rel="stylesheet" />
    <link href="CSS/style.css" rel="stylesheet" />


    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>


    <title>InfoPortugal</title>
  </head>
  <body onload="main('population')">

    <div class="main" id="body">

      <!-- 
          SideMenu Generated
      -->
      
      <main>
        <div class="container" style="text-align: center;">
          <div class="row">
            <div class="col-md-6">

                <div class="row">
                  <p style="margin: auto;">Esta1</p>
                  <div id="my_dataviz"></div>
                </div>
                <div class="row">
                  <p style="margin: auto;">Esta2</p>
                </div>
                <div class="row">
                  <p style="margin: auto;">Esta3</p>
                </div>

            </div>
            <div class="col-md-6">
              AQUELA
            </div>
          </div>
        </div>


      </main>


      

    </div>

    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"
    ></script>

    <!-- MY JS -->
    <script src="JS/index.js"></script>
    <script src="JS/menu.js"></script>
    <script src="JS/home.js"></script>

    <script type="text/javascript">

      // set the dimensions and margins of the graph
      var margin = {top: 10, right: 30, bottom: 30, left: 40},
          width = 460 - margin.left - margin.right,
          height = 400 - margin.top - margin.bottom;
      
      var dataset = [{
        4: 990},{
        8: 962},{
        12: 955},{
        16: 955},{
        20: 953},{
        24: 934},{
        28: 930}]
    
      var mapped = dataset.map(d => {
        return {
          data: Object.keys(d)[0],
          contador: d[Object.keys(d)[0]]
        }
      });

      var x = d3.scaleBand()
                  .rangeRound([0, width])
                  .padding(.05);
                  
      var y = d3.scaleLinear()
                  .domain([0, 990])
                  .range([height, 0]);

      x.domain(mapped.map(d => d.data));
      y.domain([0, d3.max(mapped, d => d.contador)]);


      var x_axis = d3.axisBottom()
        .scale(x);
      
      var y_axis = d3.axisLeft()
        .scale(y);

      // append the svg object to the body of the page
      let svg = d3.select("#my_dataviz")
        .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        
      let xAxisTranslate = height + 10
      svg.append("g").attr("transform", "translate(50, " + xAxisTranslate  +")")
        .call(x_axis);
      
      svg.append("g")
       .attr("transform", "translate(50, 10)")
       .call(y_axis);

      svg.selectAll("bar")
          .data(mapped)
          .enter().append("rect")
            .style("fill", "steelblue")
            .attr("x", d => {return x(d.data)})
            .attr("width", x.bandwidth() )
            .attr("y", d => {return y(d.contador) })
            .attr("height", d => height - y(d.contador));

      svg.selectAll("text")
        .data(mapped)
        .join("text")
            .text(function (d) {
                return d.data;
            })
            .attr("x", function (d, i) {
                    console.log("tou aqui")
                    return (i+1) * (width / Object.keys(mapped).length) ;
            })
            .attr("y", function (d) {
                return height + 20; // padding
            })
            .attr("text-anchor", "middle")
            .attr("stroke", "white")

      /*
      // X axis: scale and draw:
      var x = d3.scaleLinear()
          .domain(["00-04", "04-08", "08-12", "12-16", "16-20", "20-24", "24-28"])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
          .range([0, width]);
      svg.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));
    
      // set the parameters for the histogram
      var histogram = d3.histogram()
          .value(function(data) { console.log(data.contador); return data.contador; })   // I need to give the vector of value
          .domain(x.domain())  // then the domain of the graphic
          .thresholds(x.ticks(70)); // then the numbers of bins
      
      console.log("vou agora")
      // And apply this function to data to get the bins
      var bins = histogram(mapped);
      console.log(bins)
      console.log("nao fiz nada")
    
      // Y axis: scale and draw:
      var y = d3.scaleLinear()
          .range([height, 0]);
          y.domain([0, d3.max(bins, function(d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
      svg.append("g")
          .call(d3.axisLeft(y));
    
      // append the bar rectangles to the svg element
      svg.selectAll("rect")
          .data(bins)
          .enter()
          .append("rect")
            .attr("x", 1)
            .attr("transform", function(d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
            .attr("width", function(d) { return x(d.x1) - x(d.x0) -1 ; })
            .attr("height", function(d) { return height - y(d.length); })
            .style("fill", "#69b3a2")
      */
    </script>
    
  </body>
</html>








